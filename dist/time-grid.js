var u=class u{static toDateString(e){return new Date(e).toLocaleDateString("sv-SE")}static toDateTimeString(e){return u.toDateString(e)+" "+new Date(e).toLocaleTimeString("en-GB")}static addDays(e,t){return Date.parse(e.substring(0,10)+" 00:00:00")+t*u.MILLISECONDS_PER_DAY}static diffDays(e,t){let i=new Date(e),r=new Date(t);return i.setHours(0,0,0,0),r.setHours(0,0,0,0),Math.floor((r.getTime()-i.getTime())/u.MILLISECONDS_PER_DAY)}static diffInMilliseconds(e,t){return Date.parse(t)-Date.parse(e)}static overlapPeriod(e,t,i,r){let s=e<=i?i:e,n=t<=r?t:r;return s<=n?[s,n]:[null,null]}static timeSlot(e,t,i,r){return Math.floor((Date.parse(r>t?t:r)-Date.parse(e))/parseInt(i)/1e3)}static setTimeOfDateTime(e,t){return e.substring(0,10)+" "+t}static toMinutes(e){let[t,i]=e.split(":");return parseInt(t)*60+parseInt(i)}static toSeconds(e){let[t,i,r]=e.split(":");return(parseInt(t)*60+parseInt(i))*60+parseInt(r)}};u.MILLISECONDS_PER_DAY=24*60*60*1e3;var o=u;var g=class{constructor(e,t){this._containerSelector=null;this._eventSelector=null;this._selector=null;this._headCursor="gc-cursor-w-resize";this._tailCursor="gc-cursor-e-resize";this._dragging=null;this._draggingStart=null;this._draggingEnd=null;this._draggingValue=null;this._draggingCount=0;this._isGrabbingHead=!1;this._isGrabbingTail=!1;this._unit=1;this._onEvent=null;this._onMove=null;this._onPreview=null;this._root=e,this._selector=t}registerCallbacks(){this._root.addEventListener("mousedown",this._onMouseDown.bind(this)),this._root.addEventListener("mousemove",this._onMouseMove.bind(this)),this._root.addEventListener("mouseup",this._onMouseUp.bind(this))}_onMouseDown(e){let t=this.pickEvent(e.target);t&&(this._isGrabbingHead=this._isGrabbingTail=t.dataset.canMove==="true"&&t.dataset.canResize==="true",t.dataset.canResize==="true"&&(this.hitHead(e.target)&&(this._isGrabbingTail=!1),this.hitTail(e.target)&&(this._isGrabbingHead=!1)),this._grabbed=this._selector.pickValueByPosition(e.x,e.y),this._dragging=t,this._draggingStart=this._dragging.dataset.start,this._draggingEnd=this._dragging.dataset.end,this.setDraggingClass(this._dragging.dataset.key,!0),this._draggingValue=null,this.updatePreview(this._grabbed),this.updateCursor(),this._draggingCount=0,e.stopImmediatePropagation())}_onMouseMove(e){if(this._dragging){let t=this._selector.pickValueByPosition(e.x,e.y);t!==null&&this.updatePreview(t),this._draggingCount++,e.stopImmediatePropagation()}}_onMouseUp(e){if(this._dragging){let t=this._dragging.dataset.key,i=this._selector.pickValueByPosition(e.x,e.y);if(i!==null&&this._grabbed!==i){let[r,s]=this.drag(i);this._onMove&&r!==null&&s!==null&&this._onMove(t,r,s)}else this._draggingCount<3?this._dragging.dataset.canClick==="true"&&this._onEvent&&this._onEvent(t):(this._onPreview&&this._onPreview(this._dragging,null,null),this.setDraggingClass(t,!1));this._dragging=null,this._isGrabbingHead=this._isGrabbingTail=null,this.updateCursor(),e.stopImmediatePropagation()}}setContainerSelector(e){return this._containerSelector=e,this}setEventSelector(e){return this._eventSelector=e,this}setHeadCursor(e){return this._headCursor=e,this}setTailCursor(e){return this._tailCursor=e,this}setUnit(e){return this._unit=e,this}onEvent(e){return this._onEvent=e,this}onMove(e){return this._onMove=e,this}onPreview(e){return this._onPreview=e,this}isDragging(){return this._dragging!==null}getGrabbedDate(){return this._grabbed}pickEvent(e){return this._root.contains(e)&&e.closest(this._containerSelector)?e.closest(this._eventSelector):null}hitHead(e){return!!e.closest(".gc-head")}hitTail(e){return!!e.closest(".gc-tail")}setDraggingClass(e,t){this._root.querySelectorAll(this._eventSelector+'[data-key="'+e+'"]').forEach(i=>{t?i.classList.add("gc-dragging"):i.classList.remove("gc-dragging")})}isAllDayDragging(){return this._dragging?.dataset.allDay==="true"}isNumber(e){return/^\d+$/.test(e)}drag(e){return this.isNumber(e)?this.dragNumber(e):this.dragDateTime(e)}dragDateTime(e){let t=o.diffInMilliseconds(this._grabbed,e),i=o.toDateTimeString(Date.parse(this._draggingStart)+(this._isGrabbingHead?t:0)),r=o.toDateTimeString(Date.parse(this._draggingEnd)+(this._isGrabbingTail?t:0));return i=i.substring(0,this._grabbed.length),r=r.substring(0,this._grabbed.length),i>r&&(this._isGrabbingHead&&(i=r),this._isGrabbingTail&&(r=i)),[i,r]}dragNumber(e){let t=parseInt(e)-parseInt(this._grabbed),i=parseInt(this._draggingStart)+(this._isGrabbingHead?t:0),r=parseInt(this._draggingEnd)+(this._isGrabbingTail?t:0);return this.isAllDayDragging()&&(i=Math.floor(i/this._unit)*this._unit,r=Math.floor(r/this._unit)*this._unit),i>r&&(this._isGrabbingHead&&(i=r),this._isGrabbingTail&&(r=i)),[i,r]}updateCursor(){this._root.classList.remove(this._headCursor,this._tailCursor),this._isGrabbingHead&&this._isGrabbingTail?this._root.classList.add("gc-cursor-move"):this._isGrabbingHead?this._root.classList.add(this._headCursor):this._isGrabbingTail&&this._root.classList.add(this._tailCursor)}updatePreview(e){if(this._draggingValue!==e){let[t,i]=this.drag(e);this._onPreview&&this._onPreview(this._dragging,t,i),this._draggingValue=e}}isGrabbingHead(){return this._isGrabbingHead}isGrabbingTail(){return this._isGrabbingTail}isGrabbingBody(){return this._isGrabbingHead&&this._isGrabbingTail}};var h=class{constructor(e,t){this._containerSelector=null;this._dateSelector=null;this._resizer=null;this._hover=null;this._onEvent=null;this._onMove=null;this._root=e,this._dateSelector=t,this.init()}init(){this._resizer=new g(this._root,this._dateSelector).setEventSelector(".gc-all-day-event-container").setHeadCursor("gc-cursor-w-resize").setTailCursor("gc-cursor-e-resize").onEvent(e=>{this._onEvent&&this._onEvent(e)}).onMove((e,t,i)=>{this._onMove&&this._onMove(e,t,i)}).onPreview((e,t,i)=>{this.removePreview(),t&&i&&this.createPreview(e,t,i)})}registerCallbacks(){this._resizer.registerCallbacks(),this._root.addEventListener("mouseover",this._onMouseOver.bind(this))}_onMouseOver(e){if(this._resizer.isDragging())return;let t=this.pickAllDayEvent(e.target,!0),i=t?t.dataset.key:null;i!==this._hover&&(this.setHoverAllDayEvent(this._hover,!1),this.setHoverAllDayEvent(this._hover=i,!0))}setContainerSelector(e){return this._resizer.setContainerSelector(e),this._containerSelector=e,this}onEvent(e){return this._onEvent=e,this}onMove(e){return this._onMove=e,this}pickAllDayEvent(e,t=!1){return this._root.contains(e)&&e.closest(this._containerSelector+(t?"":", .gc-day-grid-popup"))?e.closest(".gc-all-day-event-container"):null}setHoverAllDayEvent(e,t){e&&this._root.querySelectorAll('.gc-all-day-event-container[data-key="'+e+'"]').forEach(i=>{t?i.classList.add("gc-hover"):i.classList.remove("gc-hover")})}createPreview(e,t,i){Array.from(this._root.querySelectorAll(".gc-week, .gc-all-day-section")).forEach(r=>{let[s,n]=this.getWeekPeriod(r);if(s&&n){let[l,d]=o.overlapPeriod(t,i,s,n);if(l&&d){let _=r.querySelector('.gc-day[data-date="'+l+'"] .gc-all-day-event-preview');s<=this._resizer.getGrabbedDate()&&this._resizer.getGrabbedDate()<=n&&this.addEmptyAllDayEvents(_,this.getIndexInParent(e));let v=e.cloneNode(!0),b=o.diffDays(l,d)+1;this.adjustPreview(v,b,l===t,d===i),_.appendChild(v)}}})}getWeekPeriod(e){let t=e.querySelectorAll(".gc-day:not(.gc-disabled)");return t.length>0?[t[0].dataset.date,t[t.length-1].dataset.date]:[null,null]}adjustPreview(e,t,i,r){e.classList.remove("gc-dragging"),e.classList.remove("gc-start"),e.classList.remove("gc-end");for(let s=1;s<=7;s++)e.classList.remove("gc-"+s+"days");return e.classList.add("gc-"+t+"days"),i&&e.classList.add("gc-start"),r&&e.classList.add("gc-end"),e}getIndexInParent(e){return Array.from(e.parentNode.children).indexOf(e)}addEmptyAllDayEvents(e,t){for(let i=0;i<t;i++){let r=document.createElement("div");r.classList.add("gc-all-day-event-container"),e.appendChild(r)}}removePreview(){Array.from(this._root.querySelectorAll(".gc-all-day-event-preview")).forEach(e=>e.parentNode.replaceChild(e.cloneNode(!1),e))}};var c=class{constructor(e){this._containerSelector=null;this._elementSelector=null;this._propertyName=null;this._dateSelectionStart=null;this._dateSelectionEnd=null;this._resourceSelectionStart=null;this._resourceSelectionEnd=null;this._enabled=!0;this._multipleDates=!1;this._multipleResources=!1;this._resourceIds=null;this._onDraw=null;this._onSelect=null;this._root=e}registerCallbacks(){this._root.addEventListener("mousedown",this._mouseDown.bind(this)),this._root.addEventListener("mousemove",this._mouseMove.bind(this)),this._root.addEventListener("mouseup",this._mouseUp.bind(this))}setContainerSelector(e){return this._containerSelector=e,this}setElementSelector(e){return this._elementSelector=e,this}setPropertyName(e){return this._propertyName=e,this}setEnabled(e){return this._enabled=e,this}setMultipleDates(e){return this._multipleDates=e,this}setMultipleResources(e,t){return this._multipleResources=e,this._resourceIds=t,this}onDraw(e){return this._onDraw=e,this}onSelect(e){return this._onSelect=e,this}select(e,t=null){return this._dateSelectionStart=this._dateSelectionEnd=e,this._resourceSelectionStart=this._resourceSelectionEnd=t,this.update(),this}selectEnd(e,t=null){return this._multipleDates&&(this._dateSelectionEnd=e),this._multipleResources&&(this._resourceSelectionEnd=t),this.update(),this}deselect(){this.select(null)}getResourceSelection(){if(!this._multipleResources)return this._resourceSelectionStart?[this._resourceSelectionStart]:[];let e=this._resourceIds?.indexOf(this._resourceSelectionStart)??-1,t=this._resourceIds?.indexOf(this._resourceSelectionEnd)??-1;return e>=0&&t>=0?this._resourceIds.slice(Math.min(e,t),Math.max(e,t)+1):[]}getDateSelection(){return[this._dateSelectionStart,this._dateSelectionEnd].sort()}isSelected(){return this._dateSelectionStart!==null&&this._dateSelectionEnd!==null}_mouseDown(e){if(!this._enabled)return;let t=this.pickValueByPosition(e.x,e.y),i=this.pickResourceId(e.target);t&&(this.select(t,i),e.stopImmediatePropagation())}_mouseMove(e){if(this.isSelected()){let t=this.pickValueByPosition(e.x,e.y),i=this.pickResourceId(e.target);t&&(this.selectEnd(t,i),e.stopImmediatePropagation())}}_mouseUp(e){if(this.isSelected()){let t=this.pickValueByPosition(e.x,e.y),i=this.pickResourceId(e.target);if(t){if(this.selectEnd(t,i),this._onSelect){let[r,s]=this.getDateSelection();this._onSelect(r,s,this.getResourceSelection())}this.deselect()}e.stopImmediatePropagation()}}pickResourceId(e){return this._root.contains(e)&&e.closest(this._containerSelector)?e.closest("[data-resource-id]")?.dataset.resourceId??null:null}pickValueByPosition(e,t){return Array.from(this._root.querySelectorAll(`${this._containerSelector} ${this._elementSelector}`)).find(r=>{let s=r.getBoundingClientRect();return s.left<=e&&e<=s.right&&s.top<=t&&t<=s.bottom})?.dataset[this._propertyName]??null}getElementByValue(e){return this._root.querySelector(`${this._containerSelector} ${this._elementSelector}[data-${this._propertyName}="${e}"]`)}update(){if(this._onDraw){let[e,t]=this.getDateSelection();this._onDraw(e,t,this.getResourceSelection())}else this.highlightSelection()}highlightSelection(){let[e,t]=this.getDateSelection(),i=this.getResourceSelection(),r=i.length?i.map(s=>`${this._containerSelector} [data-resource-id="${s}"] ${this._elementSelector}`).join(","):`${this._containerSelector} ${this._elementSelector}`;this._root.querySelectorAll(`${this._containerSelector} .gc-selected`).forEach(s=>{s.classList.remove("gc-selected")}),this._root.querySelectorAll(r).forEach(s=>{let n=s.dataset[this._propertyName];e<=n&&n<=t&&s.classList.add("gc-selected")})}};var p=class{constructor(e,t){this._containerSelector=null;this._timeSelector=null;this._resizer=null;this._hover=null;this._root=e,this._timeSelector=t,this.init()}init(){this._resizer=new g(this._root,this._timeSelector).setEventSelector(".gc-timed-event-container").setHeadCursor("gc-cursor-n-resize").setTailCursor("gc-cursor-s-resize").onEvent(e=>{this._onEvent&&this._onEvent(e)}).onMove((e,t,i)=>{this._onMove&&this._onMove(e,t,i)}).onPreview((e,t,i)=>{this.removePreview(),t&&i&&this.createPreview(e,t,i)})}onEvent(e){return this._onEvent=e,this}onMove(e){return this._onMove=e,this}registerCallbacks(){this._resizer.registerCallbacks(),this._root.addEventListener("mouseover",this._onMouseOver.bind(this))}setContainerSelector(e){return this._resizer.setContainerSelector(e),this._containerSelector=e,this}_onMouseOver(e){if(this._resizer.isDragging())return;let t=this.pickEvent(e.target),i=t?t.dataset.key:null;i!==this._hover&&(this.setHoverAllDayEvent(this._hover,!1),this.setHoverAllDayEvent(this._hover=i,!0))}pickEvent(e){return this._root.contains(e)&&e.closest(this._containerSelector)?e.closest(".gc-timed-event-container"):null}setHoverAllDayEvent(e,t){e&&this._root.querySelectorAll('.gc-timed-event-container[data-key="'+e+'"]').forEach(i=>{t?i.classList.add("gc-hover"):i.classList.remove("gc-hover")})}createPreview(e,t,i){let r=e.dataset.resourceId;Array.from(this._root.querySelectorAll(this._containerSelector+' .gc-day[data-resource-id="'+r+'"]')).forEach(s=>{let[n,l]=this.getPeriodOfDay(s);if(n&&l){let[d,_]=o.overlapPeriod(t,i,n,l);if(d&&_){let[v,b]=this.getSlotPosition(s,d,_),m=e.cloneNode(!0);this.adjustPreview(m,b),v.querySelector(".gc-timed-event-preview").appendChild(m)}}})}getSlotPosition(e,t,i){let[r,s]=this.getPeriodOfDay(e),n=o.timeSlot(r,s,e.dataset.interval,t),l=o.timeSlot(r,s,e.dataset.interval,i);return[e.querySelectorAll(".gc-slot")[n],l-n+1]}getPeriodOfDay(e){return[e.dataset.start,e.dataset.end]}adjustPreview(e,t){return e.classList.remove("gc-dragging"),e.style.setProperty("--gc-span","calc("+t*100+"% + "+(t-1)+"px)"),e}removePreview(){Array.from(this._root.querySelectorAll(".gc-timed-event-preview")).forEach(e=>e.parentNode.replaceChild(e.cloneNode(!1),e))}};function S(a){return{dateSelector:c,timeSelector:c,allDayEvent:h,timedEvent:p,resourceIds:[],init(){let e=this.getResourceIds();this.dateSelector=new c(this.$el).setContainerSelector(".gc-all-day-section").setElementSelector(".gc-day").setPropertyName("date").setEnabled(a.canSelectDates).setMultipleDates(a.canSelectMultipleDates).setMultipleResources(a.canSelectMultipleResources,e).onSelect((t,i,r)=>{this.$wire.onDate(t+" 00:00:00",i+" 23:59:59",r)}),this.timeSelector=new c(this.$el).setContainerSelector(".gc-timed-section").setElementSelector(".gc-slot").setPropertyName("time").setEnabled(a.canSelectDates).setMultipleDates(a.canSelectMultipleDates).setMultipleResources(a.canSelectMultipleResources,e).onSelect((t,i,r)=>{this.$wire.onDate(t,this.timeSelector.getElementByValue(i).dataset.timeEnd,r)}),this.allDayEvent=new h(this.$el,this.dateSelector).setContainerSelector(".gc-all-day-section").onEvent(t=>{this.$wire.onEvent(t)}).onMove((t,i,r)=>{this.$wire.onMove(t,i,r)}),this.timedEvent=new p(this.$el,this.timeSelector).setContainerSelector(".gc-timed-section").onEvent(t=>{this.$wire.onEvent(t)}).onMove((t,i,r)=>{this.$wire.onMove(t,i,r)}),this.allDayEvent.registerCallbacks(),this.timedEvent.registerCallbacks(),this.dateSelector.registerCallbacks(),this.timeSelector.registerCallbacks()},getResourceIds(){return Array.from(this.$el.querySelectorAll(".gc-timed-section .gc-day[data-resource-id]")).map(e=>e.dataset.resourceId)}}}export{S as default};
