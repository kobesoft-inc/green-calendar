var S=Object.defineProperty;var f=(n,e,t)=>e in n?S(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var r=(n,e,t)=>(f(n,typeof e!="symbol"?e+"":e,t),t);var d=class{constructor(e){r(this,"_root");r(this,"_containerSelector",null);r(this,"_elementSelector",null);r(this,"_propertyName",null);r(this,"_selectionStart",null);r(this,"_selectionEnd",null);r(this,"_onSelect",null);this._root=e}registerCallbacks(){this._root.addEventListener("mousedown",this._mouseDown.bind(this)),this._root.addEventListener("mousemove",this._mouseMove.bind(this)),this._root.addEventListener("mouseup",this._mouseUp.bind(this))}setContainerSelector(e){return this._containerSelector=e,this}setElementSelector(e){return this._elementSelector=e,this}setPropertyName(e){return this._propertyName=e,this}onSelect(e){return this._onSelect=e,this}select(e){return this._selectionStart=this._selectionEnd=e,this.update(),this}selectEnd(e){return this._selectionEnd=e,this.update(),this}deselect(){this.select(null)}getSelection(){return[this._selectionStart,this._selectionEnd].sort()}isSelected(){return this._selectionStart!==null&&this._selectionEnd!==null}_mouseDown(e){let t=this.pickDateTime(e.target);t&&(this.select(t),e.stopImmediatePropagation())}_mouseMove(e){let t=this.pickDateTimeByPosition(e.x,e.y);t&&(this.selectEnd(t),e.stopImmediatePropagation())}_mouseUp(e){if(this.isSelected()){if(this.pickDateTimeByPosition(e.x,e.y)){if(this._onSelect){let[i,s]=this.getSelection();this._onSelect(i,s)}this.deselect()}e.stopImmediatePropagation()}}pickDateTime(e){return this._root.contains(e)&&e.closest(this._containerSelector)?e.closest(this._elementSelector+":not(.disabled)")?.dataset[this._propertyName]:null}pickDateTimeByPosition(e,t){return Array.from(this._root.querySelectorAll(this._containerSelector+" "+this._elementSelector)).filter(i=>{let s=i.getBoundingClientRect();return s.left<=e&&e<=s.right&&s.top<=t&&t<=s.bottom}).at(0)?.dataset[this._propertyName]}getElementByDateTime(e){return this._root.querySelector(this._containerSelector+" "+this._elementSelector+"[data-"+this._propertyName+'="'+e+'"]')}update(){let[e,t]=[this._selectionStart,this._selectionEnd].sort();this._root.querySelectorAll(this._containerSelector+" "+this._elementSelector).forEach(i=>{let s=i.dataset[this._propertyName];e<=s&&s<=t?i.classList.add("gc-selected"):i.classList.remove("gc-selected")})}};var u=class u{static toDateString(e){return new Date(e).toLocaleDateString("sv-SE")}static toDateTimeString(e){return u.toDateString(e)+" "+new Date(e).toLocaleTimeString("en-GB")}static addDays(e,t){return Date.parse(e)+t*u.MILLISECONDS_PER_DAY}static diffDays(e,t){let i=new Date(e),s=new Date(t);return i.setHours(0,0,0,0),s.setHours(0,0,0,0),Math.floor((s.getTime()-i.getTime())/u.MILLISECONDS_PER_DAY)}static diffInMilliseconds(e,t){return Date.parse(t)-Date.parse(e)}static overlapPeriod(e,t,i,s){let o=e<=i?i:e,l=t<=s?t:s;return o<=l?[o,l]:[null,null]}};r(u,"MILLISECONDS_PER_DAY",24*60*60*1e3);var c=u;var g=class{constructor(e,t){r(this,"_root");r(this,"_containerSelector",null);r(this,"_eventSelector",null);r(this,"_selector",null);r(this,"_headCursor","gc-cursor-w-resize");r(this,"_tailCursor","gc-cursor-e-resize");r(this,"_dragging",null);r(this,"_draggingPrevDate",null);r(this,"_draggingCount",0);r(this,"_grabbedDate");r(this,"_grabbedStart",!1);r(this,"_grabbedEnd",!1);r(this,"_onEvent",null);r(this,"_onMove",null);r(this,"_onPreview",null);this._root=e,this._selector=t}registerCallbacks(){this._root.addEventListener("mousedown",this._onMouseDown.bind(this)),this._root.addEventListener("mousemove",this._onMouseMove.bind(this)),this._root.addEventListener("mouseup",this._onMouseUp.bind(this))}_onMouseDown(e){let t=this.pickEvent(e.target);t&&(this._grabbedStart=this._grabbedEnd=!0,this.hitHead(e.target)&&(this._grabbedEnd=!1),this.hitTail(e.target)&&(this._grabbedStart=!1),this._grabbedDate=this._selector.pickDateTimeByPosition(e.x,e.y),this._dragging=t,this.setDragging(this._dragging.dataset.key,!0),this._draggingPrevDate=null,this.updatePreview(this._grabbedDate),this.updateCursor(),this._draggingCount=0,e.stopImmediatePropagation())}_onMouseMove(e){if(this._dragging){let t=this._selector.pickDateTimeByPosition(e.x,e.y);t&&this.updatePreview(t),this._draggingCount++,e.stopImmediatePropagation()}}_onMouseUp(e){if(this._dragging){let t=this._dragging.dataset.key,i=this._selector.pickDateTimeByPosition(e.x,e.y);if(i&&this._grabbedDate!==i){let[s,o]=this.getChangedPeriod(i);this._onMove&&this._onMove(t,s,o)}else this._draggingCount<3?this._onEvent&&this._onEvent(t):(this._onPreview&&this._onPreview(this._dragging,null,null),this.setDragging(t,!1));this._dragging=null,this._grabbedStart=this._grabbedEnd=null,this.updateCursor(),e.stopImmediatePropagation()}}setContainerSelector(e){return this._containerSelector=e,this}setEventSelector(e){return this._eventSelector=e,this}setHeadCursor(e){return this._headCursor=e,this}setTailCursor(e){return this._tailCursor=e,this}onEvent(e){return this._onEvent=e,this}onMove(e){return this._onMove=e,this}onPreview(e){return this._onPreview=e,this}isDragging(){return this._dragging!==null}getGrabbedDate(){return this._grabbedDate}pickEvent(e){return this._root.contains(e)&&e.closest(this._containerSelector)?e.closest(this._eventSelector):null}hitHead(e){return!!e.closest(".gc-head")}hitTail(e){return!!e.closest(".gc-tail")}setDragging(e,t){this._root.querySelectorAll(this._eventSelector+'[data-key="'+e+'"]').forEach(i=>{t?i.classList.add("gc-dragging"):i.classList.remove("gc-dragging")})}getChangedPeriod(e){let t=c.diffInMilliseconds(this._grabbedDate,e),i=c.toDateTimeString(Date.parse(this._dragging.dataset.start)+(this._grabbedStart?t:0)),s=c.toDateTimeString(Date.parse(this._dragging.dataset.end)+(this._grabbedEnd?t:0));return i=i.substring(0,this._grabbedDate.length),s=s.substring(0,this._grabbedDate.length),i>s&&(this._grabbedStart&&(i=s),this._grabbedEnd&&(s=i)),[i,s]}updateCursor(){this._root.classList.remove(this._headCursor,this._tailCursor),this._grabbedStart&&this._grabbedEnd?this._root.classList.add("gc-cursor-move"):this._grabbedStart?this._root.classList.add(this._headCursor):this._grabbedEnd&&this._root.classList.add(this._tailCursor)}updatePreview(e){if(this._draggingPrevDate!==e){let[t,i]=this.getChangedPeriod(e);this._onPreview&&this._onPreview(this._dragging,t,i),this._draggingPrevDate=e}}};var v=class{constructor(e,t){r(this,"_root");r(this,"_containerSelector",null);r(this,"_dateSelector",null);r(this,"_resizer",null);r(this,"_hover",null);r(this,"_onEvent",null);r(this,"_onMove",null);this._root=e,this._dateSelector=t,this.init()}init(){this._resizer=new g(this._root,this._dateSelector).setEventSelector(".gc-all-day-event-container").setHeadCursor("gc-cursor-w-resize").setTailCursor("gc-cursor-e-resize").onEvent(e=>{this._onEvent&&this._onEvent(e)}).onMove((e,t,i)=>{this._onMove&&this._onMove(e,t,i)}).onPreview((e,t,i)=>{this.removePreview(),t&&i&&this.createPreview(e,t,i)})}registerCallbacks(){this._resizer.registerCallbacks(),this._root.addEventListener("mouseover",this._onMouseOver.bind(this))}_onMouseOver(e){if(this._resizer.isDragging())return;let t=this.pickAllDayEvent(e.target,!0),i=t?t.dataset.key:null;i!==this._hover&&(this.setHoverAllDayEvent(this._hover,!1),this.setHoverAllDayEvent(this._hover=i,!0))}setContainerSelector(e){return this._resizer.setContainerSelector(e),this._containerSelector=e,this}onEvent(e){return this._onEvent=e,this}onMove(e){return this._onMove=e,this}pickAllDayEvent(e,t=!1){return this._root.contains(e)&&e.closest(this._containerSelector+(t?"":", .gc-day-grid-popup"))?e.closest(".gc-all-day-event-container"):null}setHoverAllDayEvent(e,t){e&&this._root.querySelectorAll('.gc-all-day-event-container[data-key="'+e+'"]').forEach(i=>{t?i.classList.add("gc-hover"):i.classList.remove("gc-hover")})}createPreview(e,t,i){Array.from(this._root.querySelectorAll(".gc-week, .gc-all-day-section")).forEach(s=>{let[o,l]=this.getWeekPeriod(s);if(o&&l){let[a,h]=c.overlapPeriod(t,i,o,l);if(a&&h){let _=s.querySelector('.gc-day[data-date="'+a+'"] .gc-all-day-event-preview');o<=this._resizer.getGrabbedDate()&&this._resizer.getGrabbedDate()<=l&&this.addEmptyAllDayEvents(_,this.getIndexInParent(e));let p=e.cloneNode(!0),E=c.diffDays(a,h)+1;this.adjustPreview(p,E,a===t,h===i),_.appendChild(p)}}})}getWeekPeriod(e){let t=e.querySelectorAll(".gc-day:not(.gc-disabled)");return t.length>0?[t[0].dataset.date,t[t.length-1].dataset.date]:[null,null]}adjustPreview(e,t,i,s){e.classList.remove("gc-dragging"),e.classList.remove("gc-start"),e.classList.remove("gc-end");for(let o=1;o<=7;o++)e.classList.remove("gc-"+o+"days");return e.classList.add("gc-"+t+"days"),i&&e.classList.add("gc-start"),s&&e.classList.add("gc-end"),e}getIndexInParent(e){return Array.from(e.parentNode.children).indexOf(e)}addEmptyAllDayEvents(e,t){for(let i=0;i<t;i++){let s=document.createElement("div");s.classList.add("gc-all-day-event-container"),e.appendChild(s)}}removePreview(){Array.from(this._root.querySelectorAll(".gc-all-day-event-preview")).forEach(e=>e.parentNode.replaceChild(e.cloneNode(!1),e))}};var m=class{constructor(e,t){r(this,"_root");r(this,"_containerSelector",null);r(this,"_timeSelector",null);r(this,"_resizer",null);r(this,"_hover",null);r(this,"_onEvent");r(this,"_onMove");this._root=e,this._timeSelector=t,this.init()}init(){this._resizer=new g(this._root,this._timeSelector).setEventSelector(".gc-timed-event-container").setHeadCursor("gc-cursor-n-resize").setTailCursor("gc-cursor-s-resize").onEvent(e=>{this._onEvent&&this._onEvent(e)}).onMove((e,t,i)=>{this._onMove&&this._onMove(e,t,i)}).onPreview((e,t,i)=>{this.removePreview(),t&&i&&this.createPreview(e,t,i)})}onEvent(e){return this._onEvent=e,this}onMove(e){return this._onMove=e,this}registerCallbacks(){this._resizer.registerCallbacks(),this._root.addEventListener("mouseover",this._onMouseOver.bind(this))}setContainerSelector(e){return this._resizer.setContainerSelector(e),this._containerSelector=e,this}_onMouseOver(e){if(this._resizer.isDragging())return;let t=this.pickEvent(e.target),i=t?t.dataset.key:null;i!==this._hover&&(this.setHoverAllDayEvent(this._hover,!1),this.setHoverAllDayEvent(this._hover=i,!0))}pickEvent(e){return this._root.contains(e)&&e.closest(this._containerSelector)?e.closest(".gc-timed-event-container"):null}setHoverAllDayEvent(e,t){e&&this._root.querySelectorAll('.gc-timed-event-container[data-key="'+e+'"]').forEach(i=>{t?i.classList.add("gc-hover"):i.classList.remove("gc-hover")})}createPreview(e,t,i){let s=e.dataset.resourceId;Array.from(this._root.querySelectorAll(this._containerSelector+' .gc-day[data-resource-id="'+s+'"]')).forEach(o=>{let[l,a]=[o.dataset.startTime,o.dataset.endTime];if(l&&a){let[h,_]=c.overlapPeriod(t,i,l,a);if(h&&_){let[p,E]=this.getSlotAndHeight(o,h,_),b=e.cloneNode(!0);this.adjustPreview(b,E),p.querySelector(".gc-timed-event-preview").appendChild(b)}}})}getSlotAndHeight(e,t,i){let s=e.querySelectorAll(".gc-slot"),o=0,l=s.length;for(let a=0;a<s.length;a++)s[a].dataset.time<=t&&(o=a),s[a].dataset.time<=i&&(l=a);return[s[o],l-o]}adjustPreview(e,t){return e.classList.remove("gc-dragging"),e.style.setProperty("--gc-timed-event-height",t*100+"%"),e}removePreview(){Array.from(this._root.querySelectorAll(".gc-timed-event-preview")).forEach(e=>e.parentNode.replaceChild(e.cloneNode(!1),e))}};function y(){return{dateSelector:d,timeSelector:d,allDayEvent:v,timedEvent:m,init(){this.dateSelector=new d(this.$el).setContainerSelector(".gc-all-day-section").setElementSelector(".gc-day").setPropertyName("date").onSelect((n,e)=>{this.$wire.onDate(n+" 00:00:00",e+" 23:59:59")}),this.timeSelector=new d(this.$el).setContainerSelector(".gc-timed-section").setElementSelector(".gc-slot").setPropertyName("time").onSelect((n,e)=>{this.$wire.onDate(n,this.timeSelector.getElementByDateTime(e).dataset.timeEnd)}),this.allDayEvent=new v(this.$el,this.dateSelector).setContainerSelector(".gc-all-day-section").onEvent(n=>{this.$wire.onEvent(n)}).onMove((n,e,t)=>{this.$wire.onMove(n,e,t)}),this.timedEvent=new m(this.$el,this.timeSelector).setContainerSelector(".gc-timed-section").onEvent(n=>{this.$wire.onEvent(n)}).onMove((n,e,t)=>{this.$wire.onMove(n,e,t)}),this.allDayEvent.registerCallbacks(),this.timedEvent.registerCallbacks(),this.dateSelector.registerCallbacks(),this.timeSelector.registerCallbacks()}}}export{y as default};
