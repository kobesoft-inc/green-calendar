function h(c){return{cachedVisibleCount:null,cachedDayTopHeight:null,cachedEventHeight:null,hoverAllDayEventKey:null,selectionStart:null,selectionEnd:null,draggingTimedEvent:null,draggingAllDayEvent:null,draggingAllDayEventPrevDate:null,draggingAllDayEventCount:0,grabbedDate:null,grabbedStart:!1,grabbedEnd:!1,millisecondsPerDay:24*60*60*1e3,init(){this.updateLayout(),Livewire.on("refreshCalendar",()=>{this.$nextTick(()=>this.updateLayout(!0))})},onResize(t){this.updateLayout()},updateLayout(t=!1){let e=this.getVisibleCount();(this.cachedVisibleCount!==e||t)&&(this.cachedVisibleCount=e,this.$el.querySelectorAll(".gc-week .gc-day").forEach(i=>{this.updateDay(i,e)}))},getDayHeight(){return this.$el.querySelector(".gc-week .gc-day").offsetHeight},getDayTopHeight(){return this.cachedDayTopHeight?this.cachedDayTopHeight:this.cachedDayTopHeight=this.$el.querySelector(".gc-day-top").offsetHeight},getDayBodyHeight(){return this.getDayHeight()-this.getDayTopHeight()},getEventHeight(){return this.cachedEventHeight?this.cachedEventHeight:this.cachedEventHeight=this.$el.querySelector(".gc-timed-events > .gc-all-day-event-container, .gc-timed-events > .gc-timed-event-container").offsetHeight},getVisibleCount(){return Math.floor(this.getDayBodyHeight()/this.getEventHeight())},getEventCount(t){return t.querySelectorAll(".gc-timed-events > .gc-all-day-event-container, .gc-timed-events > .gc-timed-event-container").length},setTimedEventsHeight(t,e){t.querySelector(".gc-timed-events").style.height=e+"px"},setAllDayEventsVisibility(t,e){t.querySelectorAll(".gc-all-day-events .gc-all-day-event-container").forEach((i,a)=>{a<=e?i.classList.remove("gc-hidden"):i.classList.add("gc-hidden")})},setRemainingCount(t,e){let i=t.querySelector(".gc-remaining-container");e>0?(i.children[0].innerText=c.remaining.replace(":count",e),i.classList.remove("gc-hidden")):i.classList.add("gc-hidden")},updateDay(t,e){let i=this.getEventCount(t),a=i<e?i:e-1,n=i-a;this.setTimedEventsHeight(t,this.getEventHeight()*a),this.setAllDayEventsVisibility(t,a-(n?1:0)),this.setRemainingCount(t,n)},onClick(t){let e=t.target.closest(".gc-day");if(this.hitRemaining(t.target))this.openPopup(e);else{let i=this.findEventKeyAtElement(t.target);i&&this.$wire.onEvent(i),this.closePopup()}},hitRemaining(t){return t.closest(".gc-remaining-container")!==null&&this.$el.contains(t)},openPopup(t){this.buildPopup(t),this.layoutPopup(t)},closePopup(){this.$el.querySelector(".gc-day-grid-popup").classList.add("gc-hidden")},buildPopup(t){let e=this.$el.querySelector(".gc-day-grid-popup"),i=t.querySelector(".gc-day-body").cloneNode(!0),a=e.querySelector(".gc-day-body");this.replaceAllDayEvents(i,this.getAllDayEventKeys(i)),a.parentNode.replaceChild(i,a),this.adjustPopup(e),e.querySelector(".gc-date").innerText=t.querySelector(".gc-date").innerText},getAllDayEventKeys(t){return Array.from(t.querySelectorAll(".gc-timed-events .gc-all-day-event-container[data-key]")).map(e=>e.dataset.key).filter(e=>e!=="")},replaceAllDayEvents(t,e){Array.from(t.querySelectorAll(".gc-all-day-event-container")).forEach(a=>a.parentNode.removeChild(a));let i=t.querySelector(".gc-all-day-events");e.forEach(a=>{let n=this.$el.querySelector('.gc-all-day-events .gc-all-day-event-container[data-key="'+a+'"]').cloneNode(!0);n.classList.add("gc-start","gc-end"),i.appendChild(n)})},adjustPopup(t){t.classList.remove("gc-hidden"),t.style.width="auto",t.style.height="auto";let e=t.querySelector(".gc-timed-events");e.style.height="auto";let i=t.querySelector(".gc-remaining-container");i.parentNode.removeChild(i)},layoutPopup(t){let e=this.$el.querySelector(".gc-day-grid-popup"),i=e.getBoundingClientRect(),a=t.getBoundingClientRect(),n=a.left-1+window.scrollX,l=a.top-1+window.scrollY,s=Math.max(a.width*1.1,i.width),r=Math.max(a.height,i.height);n+s>window.innerWidth&&(n=window.innerWidth-s),l+r>window.innerHeight&&(n=window.innerHeight-r),e.style.left=n+"px",e.style.top=l+"px",e.style.width=s+"px",e.style.height=r+"px"},onMouseDown(t){this.hitRemaining(t.target)||this.findTimedEventAtElement(t.target)||this.updateAllDayEventStart(t)||this.updateSelectionStart(t)},onMouseMove(t){this.updateAllDayEventMove(t)||this.updateSelectionMove(t)},onMouseUp(t){this.updateAllDayEventEnd(t)||this.updateSelectionEnd(t)},onMouseOver(t){this.updateHoverAllDayEvent(t)},updateHoverAllDayEvent(t){if(this.draggingAllDayEvent||this.selectionStart)return;let e=this.findAllDayEventAtElement(t.target),i=e?e.dataset.key:null;i!==this.hoverAllDayEventKey&&(this.setHoverAllDayEvent(this.hoverAllDayEventKey,!1),this.setHoverAllDayEvent(this.hoverAllDayEventKey=i,!0))},findTimedEventAtElement(t){return this.$el.contains(t)&&t.closest(".gc-day-grid")?t.closest(".gc-timed-event-container"):null},findAllDayEventAtElement(t){return this.$el.contains(t)&&t.closest(".gc-day-grid")?t.closest(".gc-all-day-event-container"):null},findEventKeyAtElement(t){if(this.$el.contains(t)&&t.closest(".gc-day-grid")){let e=t.closest(".gc-timed-event-container, .gc-all-day-event-container");if(e)return e.dataset.key}return null},setHoverAllDayEvent(t,e){t&&this.$el.querySelectorAll('.gc-all-day-event-container[data-key="'+t+'"]').forEach(i=>{e?i.classList.add("gc-hover"):i.classList.remove("gc-hover")})},findDateAtElement(t){if(this.$el.contains(t)&&t.closest(".gc-day-grid")){let e=t.closest(".gc-day");if(e)return e.dataset.date}return null},findDateAtPoint(t,e){let i=Array.from(this.$el.querySelectorAll(".gc-day-grid .gc-day")).filter(a=>{let n=a.getBoundingClientRect();return n.left<=t&&t<=n.right&&n.top<=e&&e<=n.bottom}).at(0);return i?i.dataset.date:null},updateSelection(t,e){t>e&&([t,e]=[e,t]),this.$el.querySelectorAll(".gc-day-grid .gc-day").forEach(i=>{let a=i.dataset.date;t&&e&&t<=a&&a<=e?i.classList.add("gc-selected"):i.classList.remove("gc-selected")})},updateSelectionStart(t){let e=this.findDateAtElement(t.target);e&&(this.selectionStart=this.selectionEnd=e)},updateSelectionMove(t){let e=this.findDateAtPoint(t.x,t.y);this.selectionStart&&(this.selectionEnd=e,this.updateSelection(this.selectionStart,this.selectionEnd))},updateSelectionEnd(t){let e=this.findDateAtPoint(t.x,t.y);if(this.selectionStart){let[i,a]=[this.selectionStart,e].sort();this.$wire.onDate(i+" 00:00:00",a+" 23:59:59"),this.selectionStart=this.selectionEnd=null,this.updateSelection(null,null)}},onDragStart(t){let e=t.target.closest(".gc-timed-event-container");e&&(this.draggingTimedEvent=e,t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e.dataset.key),this.$nextTick(()=>{e.classList.add("gc-dragging")}))},onDragOver(t){let e=this.findDateAtPoint(t.x,t.y);e&&(this.updateSelection(e,e),t.preventDefault())},onDrop(t){let e=this.findDateAtPoint(t.x,t.y),i=t.dataTransfer.getData("text/plain");if(e){let a=this.diffDays(this.draggingTimedEvent.dataset.start,e);if(a!==0){let n=this.toDateTimeString(this.addDays(this.draggingTimedEvent.dataset.start,a)),l=this.toDateTimeString(this.addDays(this.draggingTimedEvent.dataset.end,a));this.$wire.onMove(i,n,l),this.draggingTimedEvent=null}}},onDragEnd(t){this.updateSelection(null,null),this.draggingTimedEvent&&(this.draggingTimedEvent.classList.remove("gc-dragging"),this.draggingTimedEvent=null)},setAllDayEventDragging(t,e){this.$el.querySelectorAll('.gc-all-day-event-container[data-key="'+t+'"]').forEach(i=>{e?i.classList.add("gc-dragging"):i.classList.remove("gc-dragging")})},updateAllDayEventStart(t){let e=this.findAllDayEventAtElement(t.target);return e?(this.grabbedStart=this.grabbedEnd=!0,this.hitHead(t.target)&&(this.grabbedEnd=!1),this.hitTail(t.target)&&(this.grabbedStart=!1),this.grabbedDate=this.findDateAtPoint(t.x,t.y),this.draggingAllDayEvent=e,this.setAllDayEventDragging(this.draggingAllDayEvent.dataset.key,!0),this.draggingAllDayEventPrevDate=null,this.updateAllDayEventPreview(this.grabbedDate),this.updateAllDayEventCursor(),this.draggingAllDayEventCount=0,!0):!1},hitHead(t){return!!t.closest(".gc-head")},hitTail(t){return!!t.closest(".gc-tail")},updateAllDayEventMove(t){if(this.draggingAllDayEvent){let e=this.findDateAtPoint(t.x,t.y);return e&&this.updateAllDayEventPreview(e),this.draggingAllDayEventCount++,!0}return!1},updateAllDayEventEnd(t){if(this.draggingAllDayEvent){let e=this.draggingAllDayEvent.dataset.key,i=this.findDateAtPoint(t.x,t.y);if(i&&this.grabbedDate!==i){let[a,n]=this.getChangedAllDayEventPeriod(i);this.$wire.onMove(e,a,n)}else this.draggingAllDayEventCount<2?this.$wire.onEvent(e):(this.removeAllDayEventPreview(),this.setAllDayEventDragging(e,!1));return this.draggingAllDayEvent=null,this.grabbedStart=this.grabbedEnd=null,this.updateAllDayEventCursor(),!0}return!1},updateAllDayEventPreview(t){if(this.draggingAllDayEventPrevDate!==t){let[e,i]=this.getChangedAllDayEventPeriod(t);this.removeAllDayEventPreview(),this.createAllDayEventPreview(this.draggingAllDayEvent,e,i),this.draggingAllDayEventPrevDate=t}},updateAllDayEventCursor(){this.$el.classList.remove("gc-day-grid-cursor-w-resize","gc-day-grid-cursor-e-resize"),this.grabbedStart&&this.$el.classList.add("gc-day-grid-cursor-w-resize"),this.grabbedEnd&&this.$el.classList.add("gc-day-grid-cursor-e-resize")},getChangedAllDayEventPeriod(t){let e=this.diffDays(this.grabbedDate,t),i=this.toDateString(this.addDays(this.draggingAllDayEvent.dataset.start,this.grabbedStart?e:0)),a=this.toDateString(this.addDays(this.draggingAllDayEvent.dataset.end,this.grabbedEnd?e:0));return i>a&&(this.grabbedStart&&(i=a),this.grabbedEnd&&(a=i)),[i,a]},createAllDayEventPreview(t,e,i){Array.from(this.$el.querySelectorAll(".gc-week")).forEach(a=>{let[n,l]=this.getWeekPeriod(a),[s,r]=this.overlapPeriod(e,i,n,l);if(s&&r){let d=a.querySelector('.gc-day[data-date="'+s+'"] .gc-all-day-event-preview');n<=this.grabbedDate&&this.grabbedDate<=l&&this.addEmptyAllDayEvents(d,this.getIndexInParent(t));let o=t.cloneNode(!0),g=this.diffDays(s,r)+1;this.adjustAllDayEventForPreview(o,g,s===e,r===i),d.appendChild(o)}})},getWeekPeriod(t){return[t.querySelector(".gc-day:first-child").dataset.date,t.querySelector(".gc-day:last-child").dataset.date]},overlapPeriod(t,e,i,a){return[t<=a&&i<=e?t<i?i:t:null,t<=a&&i<=e?e<a?e:a:null]},adjustAllDayEventForPreview(t,e,i,a){t.classList.remove("gc-dragging"),t.classList.remove("gc-start"),t.classList.remove("gc-end");for(let n=1;n<=7;n++)t.classList.remove("gc-"+n+"days");return t.classList.add("gc-"+e+"days"),i&&t.classList.add("gc-start"),a&&t.classList.add("gc-end"),t},toDateString(t){return new Date(t).toLocaleDateString("sv-SE")},toDateTimeString(t){return this.toDateString(t)+" "+new Date(t).toLocaleTimeString("en-GB")},addDays(t,e){return Date.parse(t)+e*this.millisecondsPerDay},diffDays(t,e){let i=new Date(t),a=new Date(e);return i.setHours(0,0,0,0),a.setHours(0,0,0,0),Math.floor((a.getTime()-i.getTime())/this.millisecondsPerDay)},getIndexInParent(t){return Array.from(t.parentNode.children).indexOf(t)},addEmptyAllDayEvents(t,e){for(let i=0;i<e;i++){let a=document.createElement("div");a.classList.add("gc-all-day-event-container"),t.appendChild(a)}},removeAllDayEventPreview(){Array.from(this.$el.querySelectorAll(".gc-all-day-event-preview")).forEach(t=>t.parentNode.replaceChild(t.cloneNode(!1),t))}}}export{h as default};
