var _=Object.defineProperty;var p=(a,t,e)=>t in a?_(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var r=(a,t,e)=>(p(a,typeof t!="symbol"?t+"":t,e),e);var c=class c{static toDateString(t){return new Date(t).toLocaleDateString("sv-SE")}static toDateTimeString(t){return c.toDateString(t)+" "+new Date(t).toLocaleTimeString("en-GB")}static addDays(t,e){return Date.parse(t.substring(0,10)+" 00:00:00")+e*c.MILLISECONDS_PER_DAY}static diffDays(t,e){let i=new Date(t),s=new Date(e);return i.setHours(0,0,0,0),s.setHours(0,0,0,0),Math.floor((s.getTime()-i.getTime())/c.MILLISECONDS_PER_DAY)}static diffInMilliseconds(t,e){return Date.parse(e)-Date.parse(t)}static overlapPeriod(t,e,i,s){let o=t<=i?i:t,l=e<=s?e:s;return o<=l?[o,l]:[null,null]}static timeSlot(t,e,i,s){return Math.floor((Date.parse(s>e?e:s)-Date.parse(t))/parseInt(i)/1e3)}static setTimeOfDateTime(t,e){return t.substring(0,10)+" "+e}static toMinutes(t){let[e,i]=t.split(":");return parseInt(e)*60+parseInt(i)}static toSeconds(t){let[e,i,s]=t.split(":");return(parseInt(e)*60+parseInt(i))*60+parseInt(s)}};r(c,"MILLISECONDS_PER_DAY",24*60*60*1e3);var n=c;var u=class{constructor(t){r(this,"_root");r(this,"_timeSlotWidth",null);r(this,"_eventHeight",null);r(this,"_startDate",null);r(this,"_endDate",null);r(this,"_startTime",null);r(this,"_endTime",null);r(this,"_interval",null);r(this,"_perDay",null);r(this,"_timeSlotTotal",null);this._root=t,this.init()}init(){this._startDate=this._root.dataset.startDate,this._endDate=this._root.dataset.endDate,this._startTime=n.toSeconds(this._root.dataset.startTime),this._endTime=n.toSeconds(this._root.dataset.endTime),this._interval=parseInt(this._root.dataset.interval),this._perDay=Math.ceil((this._endTime-this._startTime)/this._interval),this._timeSlotTotal=this._perDay*(n.diffDays(this._startDate,this._endDate)+1)}registerCallbacks(){window.addEventListener("resize",this._onResize.bind(this))}_onResize(){this.updateLayout()}updateLayout(){this._root.querySelectorAll(".gc-events .gc-resource").forEach(t=>{this.getResourceHeadingElement(t.dataset.resourceId).style.height=t.offsetHeight+"px"}),this._root.querySelectorAll(".gc-events .gc-all-day-events .gc-all-day-event-container, .gc-events .gc-timed-events .gc-timed-event-container").forEach(t=>{this.updateEventLayout(t)}),this._root.querySelectorAll(".gc-all-day-event-position.invisible, .gc-timed-event-position.invisible").forEach(t=>{t.classList.remove("invisible")})}getResourceHeadingElement(t){return this._root.querySelector('.gc-resources .gc-resource[data-resource-id="'+t+'"]')}getTimeSlotWidth(){return this._timeSlotWidth===null&&(this._timeSlotWidth=this._root.querySelector(".gc-time-slot").offsetWidth+1),this._timeSlotWidth}getTimeSlot(t){return this._root.querySelector('.gc-time-slot-lines .gc-time-slot[data-index="'+t+'"]')}getEventHeight(){return this._eventHeight===null&&(this._eventHeight=this._root.querySelector(".gc-events .gc-all-day-events .gc-spacer").offsetHeight),this._eventHeight}getDateTimeByIndex(t,e=!1){let i=n.addDays(this._startDate,Math.floor(t/this._perDay)),s=this._startTime+t%this._perDay*this._interval;return this._interval===3600&&s!=this._startTime&&(s=Math.floor(s/3600)*3600),e&&(s+=this._interval),s>=this._endTime&&(s=this._endTime),n.toDateTimeString(i+s*1e3)}getIndexByDateTime(t,e){let i=n.toMinutes(t.substring(11,16))-(e?1:0),s=n.diffDays(this._startDate,t.substring(0,10)),o=Math.floor((Math.min(i,this._endTime)-this._startTime)/this._interval);return this._perDay*s+Math.max(0,o)}getTimeSlotsPerDay(){return this._perDay}updateEventLayout(t){t.classList.remove("gc-start","gc-end");let e=parseInt(t.dataset.start);e<0?e=0:t.classList.add("gc-start");let i=parseInt(t.dataset.end);i>this._timeSlotTotal?i=this._timeSlotTotal:t.classList.add("gc-end");let s=t.parentNode;s.style.left=e*this.getTimeSlotWidth()+"px",s.style.width=(i-e)*this.getTimeSlotWidth()+"px",s.style.top=parseInt(t.dataset.position)*this.getEventHeight()+"px"}};var h=class{constructor(t){r(this,"_root");r(this,"_containerSelector",null);r(this,"_elementSelector",null);r(this,"_propertyName",null);r(this,"_selectionStart",null);r(this,"_selectionEnd",null);r(this,"_resourceId",null);r(this,"_enabled",!0);r(this,"_multiple",!1);r(this,"_onDraw",null);r(this,"_onSelect",null);this._root=t}registerCallbacks(){this._root.addEventListener("click",this._click.bind(this)),this._root.addEventListener("mousedown",this._mouseDown.bind(this)),this._root.addEventListener("mousemove",this._mouseMove.bind(this)),this._root.addEventListener("mouseup",this._mouseUp.bind(this))}setContainerSelector(t){return this._containerSelector=t,this}setElementSelector(t){return this._elementSelector=t,this}setPropertyName(t){return this._propertyName=t,this}setEnabled(t){return this._enabled=t,this}setMultiple(t){return this._multiple=t,this}onDraw(t){return this._onDraw=t,this}onSelect(t){return this._onSelect=t,this}select(t){return this._selectionStart=this._selectionEnd=t,this.update(),this}selectEnd(t){return this._selectionEnd=t,this.update(),this}deselect(){this.select(null)}getSelection(){return[this._selectionStart,this._selectionEnd].sort()}isSelected(){return this._selectionStart!==null&&this._selectionEnd!==null}_click(t){if(!this._enabled)return;let e=this.pickValueByPosition(t.x,t.y);e&&(this._resourceId=this.pickResourceId(t.target),this._onSelect&&this._onSelect(e,e,this._resourceId),t.stopImmediatePropagation())}_mouseDown(t){if(!this._enabled||!this._multiple)return;let e=this.pickValueByPosition(t.x,t.y);e&&(this._resourceId=this.pickResourceId(t.target),this.select(e),t.stopImmediatePropagation())}_mouseMove(t){if(this.isSelected()){let e=this.pickValueByPosition(t.x,t.y);e&&(this.selectEnd(e),t.stopImmediatePropagation())}}_mouseUp(t){if(this.isSelected()){if(this.pickValueByPosition(t.x,t.y)){if(this._onSelect){let[i,s]=this.getSelection();this._onSelect(i,s,this._resourceId)}this.deselect()}t.stopImmediatePropagation()}}pickValue(t){return this._root.contains(t)&&t.closest(this._containerSelector)?t.closest(this._elementSelector+":not(.disabled)")?.dataset[this._propertyName]:null}pickResourceId(t){return this._root.contains(t)&&t.closest(this._containerSelector)?t.closest("[data-resource-id]")?.dataset.resourceId??null:null}pickValueByPosition(t,e){return Array.from(this._root.querySelectorAll(this._containerSelector+" "+this._elementSelector)).filter(i=>{let s=i.getBoundingClientRect();return s.left<=t&&t<=s.right&&s.top<=e&&e<=s.bottom}).at(0)?.dataset[this._propertyName]??null}getElementByValue(t){return this._root.querySelector(this._containerSelector+" "+this._elementSelector+"[data-"+this._propertyName+'="'+t+'"]')}update(){if(this._onDraw){let[i,s]=this.getSelection();return this._onDraw(i,s,this._resourceId)}let[t,e]=this.getSelection();this._root.querySelectorAll(this._containerSelector+(this._resourceId!==null?' [data-resource-id="'+this._resourceId+'"] ':" ")+this._elementSelector).forEach(i=>{let s=i.dataset[this._propertyName];t<=s&&s<=e?i.classList.add("gc-selected"):i.classList.remove("gc-selected")})}};var d=class{constructor(t){r(this,"_root");r(this,"_timeSlotWidth",null);this._root=t}getTimeSlotWidth(){return this._timeSlotWidth===null&&(this._timeSlotWidth=this._root.querySelector(".gc-time-slot").offsetWidth+1),this._timeSlotWidth}draw(t,e,i){if(this.removeSelection(),t!==null&&e!==null){let[s,o]=[parseInt(t),parseInt(e)];s>o&&([s,o]=[o,s]),this.createSelectionElement(s,o,i)}}removeSelection(){let t=this._root.querySelector(".gc-selection");t&&t.parentNode.removeChild(t)}createSelectionElement(t,e,i){let s=this._root.querySelector(".gc-selection-container"),o=this._root.querySelector('.gc-events .gc-resource[data-resource-id="'+i+'"]'),l=document.createElement("div");l.className="gc-selection",l.style.left=t*this.getTimeSlotWidth()+"px",l.style.top=o.offsetTop+"px",l.style.width=(e-t+1)*this.getTimeSlotWidth()+"px",l.style.height=o.offsetHeight+"px",s.prepend(l)}};var g=class{constructor(t,e){r(this,"_root");r(this,"_containerSelector",null);r(this,"_eventSelector",null);r(this,"_selector",null);r(this,"_headCursor","gc-cursor-w-resize");r(this,"_tailCursor","gc-cursor-e-resize");r(this,"_dragging",null);r(this,"_draggingStart",null);r(this,"_draggingEnd",null);r(this,"_draggingValue",null);r(this,"_draggingCount",0);r(this,"_grabbed");r(this,"_isGrabbingHead",!1);r(this,"_isGrabbingTail",!1);r(this,"_unit",1);r(this,"_onEvent",null);r(this,"_onMove",null);r(this,"_onPreview",null);this._root=t,this._selector=e}registerCallbacks(){this._root.addEventListener("mousedown",this._onMouseDown.bind(this)),this._root.addEventListener("mousemove",this._onMouseMove.bind(this)),this._root.addEventListener("mouseup",this._onMouseUp.bind(this)),this._root.addEventListener("click",this._onClick.bind(this))}_onClick(t){let e=this.pickEvent(t.target);e&&(e.dataset.canClick==="true"&&e.dataset.canMove==="false"&&e.dataset.canResize==="false"&&this._onEvent&&this._onEvent(e.dataset.key),t.stopImmediatePropagation())}_onMouseDown(t){let e=this.pickEvent(t.target);e&&(e.dataset.canMove==="true"||e.dataset.canResize==="true")&&(this._isGrabbingHead=this._isGrabbingTail=!0,this.hitHead(t.target)&&(this._isGrabbingTail=!1),this.hitTail(t.target)&&(this._isGrabbingHead=!1),this._grabbed=this._selector.pickValueByPosition(t.x,t.y),this._dragging=e,this._draggingStart=this._dragging.dataset.start,this._draggingEnd=this._dragging.dataset.end,this.setDraggingClass(this._dragging.dataset.key,!0),this._draggingValue=null,this.updatePreview(this._grabbed),this.updateCursor(),this._draggingCount=0,t.stopImmediatePropagation())}_onMouseMove(t){if(this._dragging){let e=this._selector.pickValueByPosition(t.x,t.y);e!==null&&this.updatePreview(e),this._draggingCount++,t.stopImmediatePropagation()}}_onMouseUp(t){if(this._dragging){let e=this._dragging.dataset.key,i=this._selector.pickValueByPosition(t.x,t.y);if(i!==null&&this._grabbed!==i){let[s,o]=this.drag(i);this._onMove&&s!==null&&o!==null&&this._onMove(e,s,o)}else this._draggingCount<3?this._dragging.dataset.canClick==="true"&&this._onEvent&&this._onEvent(e):(this._onPreview&&this._onPreview(this._dragging,null,null),this.setDraggingClass(e,!1));this._dragging=null,this._isGrabbingHead=this._isGrabbingTail=null,this.updateCursor(),t.stopImmediatePropagation()}}setContainerSelector(t){return this._containerSelector=t,this}setEventSelector(t){return this._eventSelector=t,this}setHeadCursor(t){return this._headCursor=t,this}setTailCursor(t){return this._tailCursor=t,this}setUnit(t){return this._unit=t,this}onEvent(t){return this._onEvent=t,this}onMove(t){return this._onMove=t,this}onPreview(t){return this._onPreview=t,this}isDragging(){return this._dragging!==null}getGrabbedDate(){return this._grabbed}pickEvent(t){return this._root.contains(t)&&t.closest(this._containerSelector)?t.closest(this._eventSelector):null}hitHead(t){return!!t.closest(".gc-head")}hitTail(t){return!!t.closest(".gc-tail")}setDraggingClass(t,e){this._root.querySelectorAll(this._eventSelector+'[data-key="'+t+'"]').forEach(i=>{e?i.classList.add("gc-dragging"):i.classList.remove("gc-dragging")})}isAllDayDragging(){return this._dragging?.dataset.allDay==="true"}isNumber(t){return/^\d+$/.test(t)}drag(t){return this.isNumber(t)?this.dragNumber(t):this.dragDateTime(t)}dragDateTime(t){let e=n.diffInMilliseconds(this._grabbed,t),i=n.toDateTimeString(Date.parse(this._draggingStart)+(this._isGrabbingHead?e:0)),s=n.toDateTimeString(Date.parse(this._draggingEnd)+(this._isGrabbingTail?e:0));return i=i.substring(0,this._grabbed.length),s=s.substring(0,this._grabbed.length),i>s&&(this._isGrabbingHead&&(i=s),this._isGrabbingTail&&(s=i)),[i,s]}dragNumber(t){let e=parseInt(t)-parseInt(this._grabbed),i=parseInt(this._draggingStart)+(this._isGrabbingHead?e:0),s=parseInt(this._draggingEnd)+(this._isGrabbingTail?e:0);return this.isAllDayDragging()&&(i=Math.floor(i/this._unit)*this._unit,s=Math.floor(s/this._unit)*this._unit),i>s&&(this._isGrabbingHead&&(i=s),this._isGrabbingTail&&(s=i)),[i,s]}updateCursor(){this._root.classList.remove(this._headCursor,this._tailCursor),this._isGrabbingHead&&this._isGrabbingTail?this._root.classList.add("gc-cursor-move"):this._isGrabbingHead?this._root.classList.add(this._headCursor):this._isGrabbingTail&&this._root.classList.add(this._tailCursor)}updatePreview(t){if(this._draggingValue!==t){let[e,i]=this.drag(t);this._onPreview&&this._onPreview(this._dragging,e,i),this._draggingValue=t}}isGrabbingHead(){return this._isGrabbingHead}isGrabbingTail(){return this._isGrabbingTail}isGrabbingBody(){return this._isGrabbingHead&&this._isGrabbingTail}};function m(a){return{timelineLayout:null,selector:null,timelineSelection:null,timelineResizer:null,init(){this.timelineLayout=new u(this.$el),this.timelineLayout.registerCallbacks(),this.$nextTick(()=>{this.timelineLayout.updateLayout()}),this.timelineSelection=new d(this.$el),this.selector=new h(this.$el).setContainerSelector(".gc-main").setElementSelector(".gc-time-slot").setPropertyName("index").setEnabled(a.canSelectDates).setMultiple(a.canSelectMultipleDates).onDraw((t,e,i)=>{this.timelineSelection.draw(this.selector.getElementByValue(t)?.dataset.index??null,this.selector.getElementByValue(e)?.dataset.index??null,i)}).onSelect((t,e,i)=>{this.$wire.onDate(this.timelineLayout.getDateTimeByIndex(t),this.timelineLayout.getDateTimeByIndex(e,!0),i)}),this.resizer=new g(this.$el,this.selector).setContainerSelector(".gc-main").setEventSelector(".gc-all-day-event-container,.gc-timed-event-container").setHeadCursor("gc-cursor-w-resize").setTailCursor("gc-cursor-e-resize").setUnit(this.timelineLayout.getTimeSlotsPerDay()).onMove((t,e,i)=>{this.resizer.isAllDayDragging()?this.$wire.onMove(t,n.setTimeOfDateTime(this.timelineLayout.getDateTimeByIndex(parseInt(e),!1),"00:00:00"),n.setTimeOfDateTime(this.timelineLayout.getDateTimeByIndex(parseInt(i)-1,!1),"23:59:59")):this.$wire.onMove(t,this.timelineLayout.getDateTimeByIndex(parseInt(e),!1),this.timelineLayout.getDateTimeByIndex(parseInt(i)-1,!0))}).onEvent(t=>{this.$wire.onEvent(t)}).onPreview((t,e,i)=>{e!==null&&i!==null&&(t.dataset.start=e,t.dataset.end=i,this.timelineLayout.updateEventLayout(t))}),this.resizer.registerCallbacks(),this.selector.registerCallbacks(),Livewire.hook("request",({uri:t,options:e,payload:i,respond:s,succeed:o,fail:l})=>{o(({status:b,json:v})=>{this.$nextTick(()=>this.timelineLayout.updateLayout())})})}}}export{m as default};
